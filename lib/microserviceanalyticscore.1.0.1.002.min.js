/*! microserviceanalyticscore 2015-12-29 */
"use strict";!function(a){function b(){var b=a.crypto||a.msCrypto;if(!h&&b&&b.getRandomValues)try{var c=new Uint8Array(16);k=h=function(){return b.getRandomValues(c),c},h()}catch(d){}if(!h){var e=new Array(16);i=h=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),e[b]=a>>>((3&b)<<3)&255;return e},"undefined"!=typeof console&&console.warn&&console.warn("[SECURITY] node-uuid: crypto not usable, falling back to insecure Math.random()")}}function c(){if("function"==typeof require)try{var a=require("crypto").randomBytes;j=h=a&&function(){return a(16)},h()}catch(b){}}function d(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=o[a])});16>e;)b[d+e++]=0;return b}function e(a,b){var c=b||0,d=n;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function f(a,b,c){var d=b&&c||0,f=b||[];a=a||{};var g=null!=a.clockseq?a.clockseq:s,h=null!=a.msecs?a.msecs:(new Date).getTime(),i=null!=a.nsecs?a.nsecs:u+1,j=h-t+(i-u)/1e4;if(0>j&&null==a.clockseq&&(g=g+1&16383),(0>j||h>t)&&null==a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");t=h,u=i,s=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[d++]=k>>>24&255,f[d++]=k>>>16&255,f[d++]=k>>>8&255,f[d++]=255&k;var l=h/4294967296*1e4&268435455;f[d++]=l>>>8&255,f[d++]=255&l,f[d++]=l>>>24&15|16,f[d++]=l>>>16&255,f[d++]=g>>>8|128,f[d++]=255&g;for(var m=a.node||r,n=0;6>n;n++)f[d+n]=m[n];return b?b:e(f)}function g(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"===a?new m(16):null,a=null),a=a||{};var f=a.random||(a.rng||h)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var g=0;16>g;g++)b[d+g]=f[g];return b||e(f)}var h,i,j,k,l;a?b():c();for(var m="function"==typeof Buffer?Buffer:Array,n=[],o={},p=0;256>p;p++)n[p]=(p+256).toString(16).substr(1),o[n[p]]=p;var q=h(),r=[1|q[0],q[1],q[2],q[3],q[4],q[5]],s=16383&(q[6]<<8|q[7]),t=0,u=0,v=g;v.v1=f,v.v4=g,v.parse=d,v.unparse=e,v.BufferClass=m,v._rng=h,v._mathRNG=i,v._nodeRNG=j,v._whatwgRNG=k,"undefined"!=typeof module&&module.exports?module.exports=v:"function"==typeof define&&define.amd?define(function(){return v}):(l=a.uuid,v.noConflict=function(){return a.uuid=l,v},a.uuid=v)}("undefined"!=typeof window?window:null),function(){function a(){o=window.setTimeout(b,m)}function b(){if(0===l.length)return void a();o=null;var b=JSON.stringify({ApplicationVersion:"1.0.0.0",Source:"javascript",Events:l});l=[];var c=new XMLHttpRequest;c.onreadystatechange=function(){c.readyState===XMLHttpRequest.DONE&&null==o&&a()},c.open("POST",n,!0),c.setRequestHeader("af-property-id",i),c.setRequestHeader("af-collection-key",j),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.send(b)}function c(){document.body.addEventListener("click",d,!0),document.body.addEventListener("click",e,!1)}function d(a){var b=a.srcElement,c=b.getAttribute("data-journey-start");c&&x.startNamedJourney(c)}function e(a){if(r){var b=a.srcElement,c=b.getAttribute("data-journey-start"),d=b.getAttribute("data-journey-noend");null===d&&c&&r.Data.JourneyCode===c&&x.endCurrentJourney(c)}}function f(){}function g(){if(u)return u;var a=p+uuid.v4();return r&&r.CorrelationIds.push(a),a}function h(a){return 200!==a}var i,j,k=this,l=[],m=3e3,n="https://collection.microserviceanalytics.com/v1/event",o=null,p="",q=!0,r=null,s=!0,t=!1,u=null,v=[],w=[],x={endJourneyAfterHttpRequest:!1,journeyCodeOwnedByScope:!1};!function(a){XMLHttpRequest.prototype.open=function(){var b=this,c=g();this.onreadystatechange=function(){b.readyState===XMLHttpRequest.DONE&&h(b.status)&&x.handleHttpError(b.status,b.response,c)},a.apply(this,arguments),this.setRequestHeader("correlation-id",c)}}(XMLHttpRequest.prototype.open),function(a){XMLHttpRequest.prototype.send=function(){a.apply(this,arguments)}}(XMLHttpRequest.prototype.send),x.configure=function(b){i=b.propertyId,j=b.propertyKey,b.endpoint&&(n=b.endpoint),b.interval&&(m=b.interval),b.collectionEndPoint&&(n=b.collectionEndPoint),p=b.correlationIdPrefix?b.correlationIdPrefix:i+"-",b.autoStartJourneys&&(q=b.autoStartJourneys),b.httpBlacklist&&(w=b.httpBlacklist),b.httpWhitelist&&(v=b.httpWhitelist),q&&c(),window.addEventListener("error",f,!0),window.onerror=f,a()},x.beginScope=function(){x.scopeCorrelationId=p+uuid.v4()},x.endScope=function(){x.scopeCorrelationId=null},x.startJourney=function(a,b,c){void 0===c&&(c=!0),void 0===b&&(b=!1),t=!1,b&&null===x.scopeCorrelationId&&(x.beginScope(),t=!0),s=c,r={EventType:"journey",EventStartDateTime:(new Date).toISOString(),EventEndDateTime:null,CorrelationIds:[],Data:{JourneyCode:a,EndedWithError:!1}},x.scopeCorrelationId&&r.CorrelationIds.push(x.scopeCorrelationId)},x.endJourney=function(a){t&&x.endScope(),r&&(r.EventEndDateTime=(new Date).toISOString(),a===!0&&(r.Data.EndedWithError=!0),l.push(r),r=null)},x.handleJavaScriptError=function(a){r&&s&&x.endJourney(!0);for(var b=[],c=ErrorStackParser.parse(a),d=0;d<c.length;d++)b.push({Filename:c[d].fileName,Line:c[d].lineNumber,Column:c[d].columnNumber,Assembly:null,Class:null,Method:null});var e={EventType:"error",EventStartDateTime:(new Date).toISOString(),EventEndDateTime:null,CorrelationIds:[],Data:{StackFrames:b,Message:a.message,ExceptionType:a.name?a.name:"javascript"}};l.push(e)},x.handleHttpError=function(){r&&s&&x.endJourney(!0)},k.analytics=x}.call();